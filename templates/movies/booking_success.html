{% extends 'users/basic.html' %}

{% block content %}
<div class="container mt-5 text-center">

    {% if status == 'pending' %}
    <!-- Improved Pending State -->
    <div class="alert alert-dark border-0 shadow-lg mb-5 p-5" style="background: #1a1a1a; border-radius: 15px;">
        <div class="spinner-grow text-primary mb-4" role="status" style="width: 4rem; height: 4rem;">
            <span class="sr-only">Verifying...</span>
        </div>
        <h2 class="display-5 font-weight-bold text-white">Finalizing your tickets...</h2>
        <p class="lead text-muted">We've received your payment! Just a few seconds while we generate your digital
            ticket.</p>

        <div class="progress mt-4 bg-dark" style="height: 5px;">
            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%">
            </div>
        </div>

        <p class="small text-muted mt-4"><i class="fas fa-lock text-success mr-2"></i> Your payment is secure. Please
            stay on this page.</p>

        <script>
            // Auto-refresh logic (checks every 3 seconds)
            setTimeout(function () {
                window.location.reload();
            }, 3000);
        </script>
    </div>

    {% else %}
    <!-- Success State -->
    <div class="mb-5">
        <div class="mb-4">
            <i class="fas fa-check-circle text-success"
                style="font-size: 5rem; text-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);"></i>
        </div>
        <h1 class="font-weight-bold text-white mb-2">Booking Confirmed!</h1>
        <p class="lead text-muted">Your tickets have been sent to your email.</p>
    </div>
    {% endif %}

    <!-- Ticket Card -->
    <div class="card mx-auto border-0 shadow-lg text-left"
        style="max-width: 450px; background: #1f1f1f; border-top: 5px solid #e50914;">
        <div class="card-body p-4">
            <h4 class="card-title text-white font-weight-bold mb-1">{{ theater.movie.name }}</h4>
            <p class="card-text text-muted mb-3">{{ theater.name }} | {{ theater.time|date:"D, d M, h:i A" }}</p>

            <div class="d-flex align-items-center mb-3 p-3 rounded" style="background: #252525;">
                <div class="mr-3 text-center">
                    <small class="text-uppercase text-muted d-block" style="font-size: 0.7rem;">Seats</small>
                    <i class="fas fa-couch text-white h4 mb-0"></i>
                </div>
                <div class="d-flex flex-wrap">
                    {% for seat in seats %}
                    <span class="badge badge-pill mr-1 mb-1 p-2 px-3"
                        style="{% if status == 'pending' %}background: #ffc107; color: #000;{% else %}background: #28a745; color: #fff;{% endif %} font-size: 0.9rem;">
                        {{ seat.seat_number }}
                    </span>
                    {% endfor %}
                </div>
            </div>

            <div class="text-center">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=BOOKING-{{ seats.0.id }}-{{ theater.id }}"
                    alt="QR Code" class="img-fluid rounded p-2 bg-white" style="width: 120px;">
                <p class="small text-muted mt-2 mb-0">Start Show This Code at Entry</p>
            </div>
        </div>
    </div>

    <div class="mt-5 mb-5">
        <a href="{% url 'movie_list' %}" class="btn btn-outline-light px-4 py-2">
            <i class="fas fa-arrow-left mr-2"></i> Book Another Movie
        </a>
    </div>
</div>
{% endblock %}